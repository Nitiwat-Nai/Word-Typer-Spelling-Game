<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Word Typer: English Spelling Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            width: 100vw;
            height: 100vh;
            position: fixed;
            touch-action: none;
        }

        .container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
            overflow: hidden;
        }

        .container::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: backgroundMove 20s linear infinite;
            pointer-events: none;
        }

        @keyframes backgroundMove {
            0% {
                transform: translate(0, 0);
            }

            100% {
                transform: translate(50px, 50px);
            }
        }

        #gameTitle {
            font-size: clamp(24px, 6vw, 36px);
            font-weight: 800;
            color: #ffffff;
            text-align: center;
            padding: 15px 10px;
            text-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            background: linear-gradient(90deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3);
            background-size: 300% 100%;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradientShift 3s ease infinite;
            z-index: 10;
        }

        @keyframes gradientShift {

            0%,
            100% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }
        }

        #topBar {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            gap: 10px;
            z-index: 10;
        }

        .score-box,
        .time-box,
        .control-btn {
            padding: 10px 15px;
            border-radius: 15px;
            font-weight: 700;
            font-size: clamp(12px, 3.5vw, 16px);
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            border: none;
            white-space: nowrap;
        }

        .score-box {
            background: linear-gradient(135deg, #00d2ff 0%, #3a7bd5 100%);
            color: white;
            flex: 1;
            text-align: center;
        }

        .time-box {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            flex: 1;
            text-align: center;
        }

        .control-btn {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: #333;
            font-weight: 800;
            flex: 1.2;
        }

        .control-btn:active {
            transform: scale(0.95);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        #gameCanvas {
            flex: 1;
            width: 100%;
            background: linear-gradient(180deg, #ffecd2 0%, #fcb69f 100%);
            box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.1);
            margin: 0;
            display: block;
        }

        #inputBox {
            width: 100%;
            padding: 15px;
            text-align: center;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            z-index: 10;
        }

        #currentInput {
            font-size: clamp(20px, 5vw, 32px);
            font-weight: 800;
            color: #ffffff;
            letter-spacing: 8px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            display: inline-block;
            animation: pulse 1s ease-in-out infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        .typed-error {
            color: #ff4757;
            animation: shake 0.3s;
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-10px);
            }

            75% {
                transform: translateX(10px);
            }
        }

        #virtualKeyboard {
            width: 100%;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(20px);
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 10;
        }

        .keyboard-row {
            display: flex;
            justify-content: center;
            gap: 5px;
        }

        .key-button {
            background: linear-gradient(135deg, #ffffff 0%, #e0e0e0 100%);
            color: #333;
            border: none;
            padding: 18px 0;
            font-size: clamp(16px, 4vw, 22px);
            font-weight: 700;
            cursor: pointer;
            border-radius: 12px;
            user-select: none;
            transition: all 0.2s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            min-width: 35px;
            flex: 1;
            max-width: 55px;
        }

        .key-button:active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: scale(0.9);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        /* Menu Screens Style */
        #menuScreen,
        #levelCompleteScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            padding: 20px;
            text-align: center;
        }

        #menuTitle {
            font-size: clamp(28px, 7vw, 42px);
            font-weight: 900;
            color: #ffffff;
            margin-bottom: 30px;
            text-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            background: linear-gradient(90deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3);
            background-size: 300% 100%;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradientShift 3s ease infinite;
        }

        #menuScreen h2 {
            color: white;
            font-size: clamp(20px, 5vw, 28px);
            margin-bottom: 20px;
            text-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            font-weight: 800;
        }

        #levelCompleteScreen #completeMessage {
            font-size: clamp(28px, 7vw, 42px);
            font-weight: 900;
            color: #feca57;
            text-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            margin-bottom: 20px;
        }

        #levelCompleteScreen #finalScore {
            font-size: clamp(20px, 5vw, 32px);
            font-weight: 800;
            color: #ffffff;
            margin-bottom: 40px;
        }

        .menu-btn {
            width: 80%;
            max-width: 300px;
            padding: 15px 10px;
            font-size: clamp(16px, 4vw, 20px);
            font-weight: 800;
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            margin-bottom: 15px;
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        #nextLevelBtn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .menu-btn:active {
            transform: scale(0.95);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
        }

        #countdownOverlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 200;
        }

        #countdownNumber {
            font-size: clamp(80px, 20vw, 150px);
            font-weight: 900;
            color: #ffffff;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.8);
            animation: countdownPulse 1s ease-in-out;
        }

        @keyframes countdownPulse {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }

            50% {
                transform: scale(1.2);
                opacity: 1;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        #levelButtonsContainer {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            padding: 10px;
            max-width: 600px;
            width: 100%;
        }

        .level-button {
            padding: 15px 10px;
            font-size: clamp(12px, 3vw, 16px);
            font-weight: 800;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            position: relative;
            overflow: hidden;
        }

        .level-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .level-button:active::before {
            width: 300px;
            height: 300px;
        }

        .level-button:active {
            transform: scale(0.95);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
        }

        @media (max-width: 400px) {
            #levelButtonsContainer {
                grid-template-columns: repeat(5, 1fr);
                gap: 8px;
            }

            .level-button {
                padding: 12px 8px;
            }
        }

        @media (orientation: landscape) and (max-height: 500px) {
            #gameTitle {
                padding: 8px 10px;
            }

            #topBar {
                padding: 5px 15px;
            }

            #inputBox {
                padding: 8px;
            }

            #virtualKeyboard {
                padding: 5px;
                gap: 4px;
            }

            .key-button {
                padding: 8px 0;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div id="gameTitle">
            üìù Word Typer Game
        </div>

        <div id="topBar" style="display: none;">
            <div class="score-box">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="scoreDisplay">0</span></div>
            <button id="pauseBtn" class="control-btn">‡∏´‡∏¢‡∏∏‡∏î/‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏•‡∏±‡∏Å</button>
            <div class="time-box">‡πÄ‡∏ß‡∏•‡∏≤: <span id="timeDisplay">0:00</span></div>
        </div>

        <div id="inputBox" style="display: none;">
            <span id="currentInput">‡∏£‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå...</span>
        </div>

        <canvas id="gameCanvas" style="display: none;"></canvas>

        <div id="virtualKeyboard" style="display: none;"></div>

        <div id="menuScreen">
            <div id="menuTitle">üìù Word Typer Game</div>
            <h2>üéÆ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏•‡πÄ‡∏ß‡∏• (1-10)</h2>
            <div id="levelButtonsContainer"></div>
        </div>

        <div id="levelCompleteScreen" style="display: none;">
            <div id="completeMessage">Level X Complete!</div>
            <div id="finalScore">Score: 0</div>
            <button id="nextLevelBtn" class="menu-btn">‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡∏ñ‡∏±‡∏î‡πÑ‡∏õ üöÄ</button>
            <button id="returnToMenuBtn" class="menu-btn">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
        </div>

        <div id="countdownOverlay">
            <div id="countdownNumber">3</div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const timeDisplay = document.getElementById('timeDisplay');
        const currentInputDisplay = document.getElementById('currentInput');
        const topBar = document.getElementById('topBar');
        const inputBox = document.getElementById('inputBox');
        const virtualKeyboard = document.getElementById('virtualKeyboard');
        const menuScreen = document.getElementById('menuScreen');
        const pauseBtn = document.getElementById('pauseBtn');
        const levelButtonsContainer = document.getElementById('levelButtonsContainer');
        const countdownOverlay = document.getElementById('countdownOverlay');
        const countdownNumber = document.getElementById('countdownNumber');

        const levelCompleteScreen = document.getElementById('levelCompleteScreen');
        const completeMessage = document.getElementById('completeMessage');
        const finalScoreDisplay = document.getElementById('finalScore');
        const nextLevelBtn = document.getElementById('nextLevelBtn');
        const returnToMenuBtnComplete = document.getElementById('returnToMenuBtn');

        let gameLoopId;

        // --- Sound Logic (New) ---
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        /**
         * Plays a simple sound effect using the Web Audio API.
         * @param {number} frequency - Base frequency (Hz).
         * @param {number} duration - Duration of the sound (seconds).
         * @param {string} type - Oscillator type ('sine', 'square', 'sawtooth', 'triangle').
         * @param {number} gain - Volume (0.0 to 1.0).
         */
        function playSound(frequency, duration, type, gain = 0.5) {
            if (!audioContext) return;

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.type = type;
            oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
            gainNode.gain.setValueAtTime(gain, audioContext.currentTime);

            // Simple decay (Attack/Decay envelope)
            gainNode.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + duration);

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.start();
            oscillator.stop(audioContext.currentTime + duration);
        }

        // --- Canvas & Resize Logic ---
        function resizeCanvas() {
            const rect = canvas.getBoundingClientRect();
            const totalFixedElementsHeight = (document.getElementById('gameTitle')?.offsetHeight || 0) +
                (topBar.style.display !== 'none' ? topBar.offsetHeight : 0) +
                (inputBox.style.display !== 'none' ? inputBox.offsetHeight : 0) +
                (virtualKeyboard.style.display !== 'none' ? virtualKeyboard.offsetHeight : 0);

            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight - totalFixedElementsHeight;

            if (isGameRunning || menuScreen.style.display === 'none') {
                // Adjust Danger Zone when resizing in game mode
                DANGER_ZONE_Y = canvas.height - 60;
            }
        }

        window.addEventListener('resize', resizeCanvas);
        window.addEventListener('orientationchange', () => {
            setTimeout(resizeCanvas, 100);
        });

        // --- Word Data ---
        // L1 & L2: 3-4 letters
        const LEVEL_1_WORDS = [
            { icon: 'üñãÔ∏è', word: 'PEN', meaning: '‡∏õ‡∏≤‡∏Å‡∏Å‡∏≤' },
            { icon: 'üê±', word: 'CAT', meaning: '‡πÅ‡∏°‡∏ß' },
            { icon: '‚òÄÔ∏è', word: 'SUN', meaning: '‡∏û‡∏£‡∏∞‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå' },
            { icon: 'üöó', word: 'CAR', meaning: '‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå' },
            { icon: 'ü¶ä', word: 'FOX', meaning: '‡∏™‡∏∏‡∏ô‡∏±‡∏Ç‡∏à‡∏¥‡πâ‡∏á‡∏à‡∏≠‡∏Å' },
            { icon: 'üêù', word: 'BEE', meaning: '‡∏ú‡∏∂‡πâ‡∏á' },
            { icon: 'ü¶ã', word: 'FLY', meaning: '‡πÅ‡∏°‡∏•‡∏á‡∏ß‡∏±‡∏ô' },
            { icon: 'üê∏', word: 'FROG', meaning: '‡∏Å‡∏ö' },
            { icon: 'üíß', word: 'DROP', meaning: '‡∏´‡∏¢‡∏î‡∏ô‡πâ‡∏≥' },
            { icon: 'üê≠', word: 'MICE', meaning: '‡∏´‡∏ô‡∏π' },
        ];

        const LEVEL_2_WORDS = [
            { icon: '‚öΩ', word: 'BALL', meaning: '‡∏•‡∏π‡∏Å‡∏ö‡∏≠‡∏•' },
            { icon: 'üßä', word: 'CUBE', meaning: '‡∏•‡∏π‡∏Å‡∏ö‡∏≤‡∏®‡∏Å‡πå' },
            { icon: 'üìò', word: 'BOOK', meaning: '‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠' },
            { icon: 'üê†', word: 'FISH', meaning: '‡∏õ‡∏•‡∏≤' },
            { icon: 'ü§∏', word: 'JUMP', meaning: '‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î' },
            { icon: 'üö∂', word: 'WALK', meaning: '‡πÄ‡∏î‡∏¥‡∏ô' },
            { icon: 'ü¶Å', word: 'LION', meaning: '‡∏™‡∏¥‡∏á‡πÇ‡∏ï' },
            { icon: 'üí°', word: 'LAMP', meaning: '‡πÇ‡∏Ñ‡∏°‡πÑ‡∏ü' },
            { icon: 'üßº', word: 'SOAP', meaning: '‡∏™‡∏ö‡∏π‡πà' },
            { icon: 'üóÑÔ∏è', word: 'DESK', meaning: '‡πÇ‡∏ï‡πä‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô' },
        ];

        // L3 & L4: 4-5 letters
        const LEVEL_3_WORDS = [
            { icon: 'üçé', word: 'APPLE', meaning: '‡πÅ‡∏≠‡∏õ‡πÄ‡∏õ‡∏¥‡∏•' },
            { icon: 'üåü', word: 'STAR', meaning: '‡∏î‡∏≤‡∏ß' },
            { icon: 'üè†', word: 'HOUSE', meaning: '‡∏ö‡πâ‡∏≤‡∏ô' },
            { icon: 'üå≥', word: 'TREE', meaning: '‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ' },
            { icon: 'üî•', word: 'FIRE', meaning: '‡πÑ‡∏ü' },
            { icon: 'üêö', word: 'SHELL', meaning: '‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏≠‡∏¢' },
            { icon: 'üöÇ', word: 'TRAIN', meaning: '‡∏£‡∏ñ‡πÑ‡∏ü' },
            { icon: 'ü™ë', word: 'CHAIR', meaning: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ' },
            { icon: 'üí¶', word: 'WATER', meaning: '‡∏ô‡πâ‡∏≥' },
            { icon: 'üß§', word: 'GLOVE', meaning: '‡∏ñ‡∏∏‡∏á‡∏°‡∏∑‡∏≠' },
        ];

        const LEVEL_4_WORDS = [
            { icon: 'üê¶', word: 'CROW', meaning: '‡∏≠‡∏µ‡∏Å‡∏≤' },
            { icon: 'üí°', word: 'LIGHT', meaning: '‡πÅ‡∏™‡∏á' },
            { icon: 'üìû', word: 'PHONE', meaning: '‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå' },
            { icon: 'ü™ô', word: 'MONEY', meaning: '‡πÄ‡∏á‡∏¥‡∏ô' },
            { icon: 'ü¶¢', word: 'SWAN', meaning: '‡∏´‡∏á‡∏™‡πå' },
            { icon: 'ü•É', word: 'GLASS', meaning: '‡πÅ‡∏Å‡πâ‡∏ß' },
            { icon: 'üëÑ', word: 'MOUTH', meaning: '‡∏õ‡∏≤‡∏Å' },
            { icon: 'üëÉ', word: 'NOSE', meaning: '‡∏à‡∏°‡∏π‡∏Å' },
            { icon: '‚úã', word: 'HANDS', meaning: '‡∏°‡∏∑‡∏≠' },
            { icon: 'ü¶∂', word: 'FOOT', meaning: '‡πÄ‡∏ó‡πâ‡∏≤' },
        ];

        // L5 - L8: 5-6 letters
        const LEVEL_5_WORDS = [
            { icon: 'üëë', word: 'CROWN', meaning: '‡∏°‡∏á‡∏Å‡∏∏‡∏é' },
            { icon: 'üåä', word: 'OCEAN', meaning: '‡∏°‡∏´‡∏≤‡∏™‡∏°‡∏∏‡∏ó‡∏£' },
            { icon: 'üï∞Ô∏è', word: 'CLOCK', meaning: '‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤' },
            { icon: 'üç™', word: 'COOKIE', meaning: '‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ' },
            { icon: 'üîë', word: 'KEY', meaning: '‡∏Å‡∏∏‡∏ç‡πÅ‡∏à' },
            { icon: 'üß±', word: 'BRICK', meaning: '‡∏≠‡∏¥‡∏ê' },
            { icon: 'üß≤', word: 'MAGNET', meaning: '‡πÅ‡∏°‡πà‡πÄ‡∏´‡∏•‡πá‡∏Å' },
            { icon: 'üìå', word: 'PIN', meaning: '‡∏´‡∏°‡∏∏‡∏î' },
            { icon: 'üïØÔ∏è', word: 'CANDLE', meaning: '‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô' },
            { icon: '‚úèÔ∏è', word: 'PENCIL', meaning: '‡∏î‡∏¥‡∏ô‡∏™‡∏≠' },
        ];

        const LEVEL_6_WORDS = [
            { icon: 'üé∏', word: 'GUITAR', meaning: '‡∏Å‡∏µ‡∏ï‡∏≤‡∏£‡πå' },
            { icon: 'üöÄ', word: 'ROCKET', meaning: '‡∏à‡∏£‡∏ß‡∏î' },
            { icon: 'ü•á', word: 'MEDAL', meaning: '‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç' },
            { icon: 'üßÖ', word: 'ONION', meaning: '‡∏´‡∏±‡∏ß‡∏´‡∏≠‡∏°' },
            { icon: 'üß©', word: 'PUZZLE', meaning: '‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤' },
            { icon: 'ü•´', word: 'SAUCE', meaning: '‡∏ã‡∏≠‡∏™' },
            { icon: 'üëï', word: 'SHIRT', meaning: '‡πÄ‡∏™‡∏∑‡πâ‡∏≠' },
            { icon: '‚òï', word: 'COFFEE', meaning: '‡∏Å‡∏≤‡πÅ‡∏ü' },
            { icon: 'üçµ', word: 'TEA', meaning: '‡∏ä‡∏≤' },
            { icon: 'ü•§', word: 'JUICE', meaning: '‡∏ô‡πâ‡∏≥‡∏ú‡∏•‡πÑ‡∏°‡πâ' },
        ];

        const LEVEL_7_WORDS = [
            { icon: 'üíø', word: 'ALBUM', meaning: '‡∏≠‡∏±‡∏•‡∏ö‡∏±‡πâ‡∏°' },
            { icon: 'üå∏', word: 'FLOWER', meaning: '‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ' },
            { icon: 'üì∑', word: 'CAMERA', meaning: '‡∏Å‡∏•‡πâ‡∏≠‡∏á' },
            { icon: 'ü™ü', word: 'WINDOW', meaning: '‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á' },
            { icon: '‚òÅÔ∏è', word: 'CLOUD', meaning: '‡πÄ‡∏°‡∏Ü' },
            { icon: 'üòä', word: 'HAPPY', meaning: '‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç' },
            { icon: 'üò¥', word: 'SLEEP', meaning: '‡∏ô‡∏≠‡∏ô' },
            { icon: '‚úçÔ∏è', word: 'WRITE', meaning: '‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô' },
            { icon: 'üìñ', word: 'READ', meaning: '‡∏≠‡πà‡∏≤‡∏ô' },
            { icon: 'üèûÔ∏è', word: 'RIVER', meaning: '‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥' },
        ];

        const LEVEL_8_WORDS = [
            { icon: 'üêß', word: 'PENGUIN', meaning: '‡∏ô‡∏Å‡πÄ‡∏û‡∏ô‡∏Å‡∏ß‡∏¥‡∏ô' },
            { icon: 'ü™°', word: 'NEEDLE', meaning: '‡πÄ‡∏Ç‡πá‡∏°' },
            { icon: 'ü™ñ', word: 'HELMET', meaning: '‡∏´‡∏°‡∏ß‡∏Å‡∏Å‡∏±‡∏ô‡∏ô‡πá‡∏≠‡∏Å' },
            { icon: 'ü™§', word: 'TRAP', meaning: '‡∏Å‡∏±‡∏ö‡∏î‡∏±‡∏Å' },
            { icon: 'üó≥Ô∏è', word: 'VOTE', meaning: '‡πÇ‡∏´‡∏ß‡∏ï' },
            { icon: 'üõí', word: 'CART', meaning: '‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤' },
            { icon: 'üìê', word: 'RULER', meaning: '‡πÑ‡∏°‡πâ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î' },
            { icon: 'üèõÔ∏è', word: 'TEMPLE', meaning: '‡∏ß‡∏±‡∏î/‡∏ß‡∏¥‡∏´‡∏≤‡∏£' },
            { icon: 'üè¢', word: 'OFFICE', meaning: '‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô' },
            { icon: 'üõ£Ô∏è', word: 'HIGHWAY', meaning: '‡∏ó‡∏≤‡∏á‡∏î‡πà‡∏ß‡∏ô' },
        ];

        // L9 & L10: 6-8 letters
        const LEVEL_9_WORDS = [
            { icon: 'üéà', word: 'BALLOON', meaning: '‡∏•‡∏π‡∏Å‡πÇ‡∏õ‡πà‡∏á' },
            { icon: 'üêò', word: 'ELEPHANT', meaning: '‡∏ä‡πâ‡∏≤‡∏á' },
            { icon: 'üêí', word: 'MONKEY', meaning: '‡∏•‡∏¥‡∏á' },
            { icon: '‚òÇÔ∏è', word: 'UMBRELLA', meaning: '‡∏£‡πà‡∏°' },
            { icon: 'ü•ï', word: 'CARROT', meaning: '‡πÅ‡∏Ñ‡∏£‡∏≠‡∏ó' },
            { icon: 'üõµ', word: 'SCOOTER', meaning: '‡∏™‡∏Å‡∏π‡πä‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡πå' },
            { icon: 'üè∞', word: 'CASTLE', meaning: '‡∏õ‡∏£‡∏≤‡∏™‡∏≤‡∏ó' },
            { icon: 'üíé', word: 'DIAMOND', meaning: '‡πÄ‡∏û‡∏ä‡∏£' },
            { icon: 'üéπ', word: 'PIANO', meaning: '‡πÄ‡∏õ‡∏µ‡∏¢‡πÇ‡∏ô' },
            { icon: 'üñºÔ∏è', word: 'PICTURE', meaning: '‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û' },
        ];

        const LEVEL_10_WORDS = [
            { icon: 'üóø', word: 'STATUE', meaning: '‡∏£‡∏π‡∏õ‡∏õ‡∏±‡πâ‡∏ô' },
            { icon: 'ü™ú', word: 'LADDER', meaning: '‡∏ö‡∏±‡∏ô‡πÑ‡∏î' },
            { icon: 'ü¶í', word: 'GIRAFFE', meaning: '‡∏¢‡∏µ‡∏£‡∏≤‡∏ü' },
            { icon: 'ü¶ï', word: 'DINOSAUR', meaning: '‡πÑ‡∏î‡πÇ‡∏ô‡πÄ‡∏™‡∏≤‡∏£‡πå' },
            { icon: 'ü™£', word: 'BUCKET', meaning: '‡∏ñ‡∏±‡∏á' },
            { icon: 'ü™ó', word: 'ACCORDION', meaning: '‡∏´‡∏µ‡∏ö‡πÄ‡∏û‡∏•‡∏á' },
            { icon: 'üõ∞Ô∏è', word: 'SATELLITE', meaning: '‡∏î‡∏≤‡∏ß‡πÄ‡∏ó‡∏µ‡∏¢‡∏°' },
            { icon: 'üí∏', word: 'PAYMENT', meaning: '‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô' },
            { icon: 'üìÆ', word: 'POSTBOX', meaning: '‡∏ï‡∏π‡πâ‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå' },
            { icon: 'üîñ', word: 'BOOKMARK', meaning: '‡∏ó‡∏µ‡πà‡∏Ñ‡∏±‡πà‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠' },
        ];

        const ALL_LEVEL_WORDS = [
            LEVEL_1_WORDS, LEVEL_2_WORDS, LEVEL_3_WORDS, LEVEL_4_WORDS, LEVEL_5_WORDS,
            LEVEL_6_WORDS, LEVEL_7_WORDS, LEVEL_8_WORDS, LEVEL_9_WORDS, LEVEL_10_WORDS
        ];

        // --- Game Constants (V2.6 Drop Logic) ---
        const BASE_SPEED = 1.0; 
        const BASE_DROP_INTERVAL = 300; // 300 frames/drop = 5 seconds/drop (at 60 FPS)

        let DANGER_ZONE_Y;
        let usedWordsInLevel = new Set();

        let score = 0;
        let startTime = 0;
        let runningTime = 0;
        let fallingIcons = [];
        let timeSinceLastDrop = 0;

        const TOTAL_WORDS_TO_COLLECT = 10;

        let dropInterval;
        let isGameRunning = false;
        let currentLevel = 0;
        let levelWords = [];
        let wordsCollected = 0;

        // --- Game Flow Functions ---

        function generateLevels() {
            levelButtonsContainer.innerHTML = '';
            levelCompleteScreen.style.display = 'none';

            for (let i = 0; i < 10; i++) {
                const button = document.createElement('button');
                button.className = 'level-button';
                // Display word length range for clarity
                let range;
                if (i < 2) range = '3-4';
                else if (i < 4) range = '4-5';
                else if (i < 8) range = '5-6';
                else range = '6-8';

                button.textContent = `L${i + 1} (${range})`;
                button.onclick = () => startGame(i);
                levelButtonsContainer.appendChild(button);
            }
        }

        async function startGame(levelIndex) {
            currentLevel = levelIndex;
            levelWords = [...ALL_LEVEL_WORDS[levelIndex]].sort(() => Math.random() - 0.5);
            usedWordsInLevel.clear();

            dropInterval = BASE_DROP_INTERVAL;
            
            score = 0;
            startTime = Date.now();
            fallingIcons.length = 0;
            wordsCollected = 0;
            scoreDisplay.textContent = score;
            currentInputDisplay.textContent = '‡∏£‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå...';

            menuScreen.style.display = 'none';
            levelCompleteScreen.style.display = 'none';
            canvas.style.display = 'block';
            topBar.style.display = 'flex';
            inputBox.style.display = 'block';
            virtualKeyboard.style.display = 'flex';

            resizeCanvas();
            DANGER_ZONE_Y = canvas.height - 60;

            await showCountdown();

            // ‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏° ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏î‡∏£‡∏≠‡∏õ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏Ñ‡∏≥‡πÅ‡∏£‡∏Å ‡πÜ 
            timeSinceLastDrop = Math.floor(Math.random() * dropInterval * 0.5);

            isGameRunning = true;
            if (!gameLoopId) {
                gameLoop();
            }
        }

        function showLevelCompleteScreen() {
            isGameRunning = false;
            fallingIcons.length = 0;

            canvas.style.display = 'none';
            topBar.style.display = 'none';
            inputBox.style.display = 'none';
            virtualKeyboard.style.display = 'none';

            levelCompleteScreen.style.display = 'flex';

            completeMessage.textContent = `Level ${currentLevel + 1} Complete! üéâ`;
            finalScoreDisplay.textContent = `Final Score: ${score}`;

            if (currentLevel < ALL_LEVEL_WORDS.length - 1) {
                nextLevelBtn.style.display = 'block';
                nextLevelBtn.onclick = () => {
                    if (currentLevel + 1 < ALL_LEVEL_WORDS.length) {
                        startGame(currentLevel + 1);
                    } else {
                        returnToMenu();
                    }
                };
            } else {
                nextLevelBtn.style.display = 'none';
                completeMessage.textContent = `All Levels Complete! üèÜ`;
            }
            returnToMenuBtnComplete.onclick = returnToMenu;
        }

        function showCountdown() {
            return new Promise((resolve) => {
                countdownOverlay.style.display = 'flex';
                let count = 3;
                countdownNumber.textContent = count;

                const countInterval = setInterval(() => {
                    count--;
                    if (count > 0) {
                        countdownNumber.textContent = count;
                        countdownNumber.style.animation = 'none';
                        setTimeout(() => {
                            countdownNumber.style.animation = 'countdownPulse 1s ease-in-out';
                        }, 10);
                    } else {
                        clearInterval(countInterval);
                        countdownOverlay.style.display = 'none';
                        resolve();
                    }
                }, 1000);
            });
        }

        function returnToMenu() {
            isGameRunning = false;
            fallingIcons.length = 0;

            canvas.style.display = 'none';
            topBar.style.display = 'none';
            inputBox.style.display = 'none';
            virtualKeyboard.style.display = 'none';
            levelCompleteScreen.style.display = 'none';
            menuScreen.style.display = 'flex';
        }

        // --- IMPORTANT: Modified speakWord function for reading word, not spelling ---
        function speakWord(word) {
            if ('speechSynthesis' in window) {
                // The utterance object will read the word as a whole word (e.g., SUN as "sun"), 
                // not by spelling it out (S-U-N), unless the word is not recognized or the language is wrong.
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.lang = 'en-US'; 
                window.speechSynthesis.speak(utterance);
            }
        }

        function createWordIcon() {
            let availableWords = levelWords.filter(w => !usedWordsInLevel.has(w.word));

            if (availableWords.length === 0) {
                // If all 10 unique words are currently in use 
                usedWordsInLevel.clear();
                availableWords = levelWords;
            }

            const wordData = availableWords[Math.floor(Math.random() * availableWords.length)];
            usedWordsInLevel.add(wordData.word);

            // ‡πÉ‡∏ä‡πâ Falling Speed ‡∏Ñ‡∏á‡∏ó‡∏µ‡πà BASE_SPEED (1.0)
            const baseSpeed = BASE_SPEED;

            return {
                x: Math.random() * (canvas.width - 60) + 30,
                y: -50,
                icon: wordData.icon,
                targetWord: wordData.word.toUpperCase(),
                remainingLetters: wordData.word.toUpperCase(),
                speed: baseSpeed,
                isDestroying: false,
                destroyScale: 1,
                iconSize: 40,
                baseSpeed: baseSpeed
            };
        }

        // --- Game Loop Logic ---
        function update() {
            if (!isGameRunning) return;

            if (wordsCollected >= TOTAL_WORDS_TO_COLLECT) {
                showLevelCompleteScreen();
                return;
            }

            runningTime = Date.now() - startTime;
            timeDisplay.textContent = formatTime(runningTime);
            
            // ‡πÉ‡∏ä‡πâ‡∏ï‡∏£‡∏£‡∏Å‡∏∞‡∏Å‡∏≤‡∏£‡∏î‡∏£‡∏≠‡∏õ‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤ (5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡∏ï‡πà‡∏≠‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô)
            timeSinceLastDrop++;
            
            if (timeSinceLastDrop >= dropInterval && wordsCollected < TOTAL_WORDS_TO_COLLECT) {
                if (levelWords.length > 0) {
                    fallingIcons.push(createWordIcon());
                }
                timeSinceLastDrop = 0;
            }

            for (let i = fallingIcons.length - 1; i >= 0; i--) {
                const icon = fallingIcons[i];

                if (icon.isDestroying) {
                    icon.destroyScale += 0.1;
                    icon.iconSize += 2;
                    if (icon.destroyScale > 2) {
                        fallingIcons.splice(i, 1);
                    }
                } else {
                    // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ô‡πâ‡∏≠‡∏¢‡∏•‡∏á
                    if (icon.remainingLetters.length < icon.targetWord.length / 2) {
                        icon.speed = icon.baseSpeed * 1.2;
                    }

                    icon.y += icon.speed;

                    // Score Deduction 
                    if (icon.y + icon.iconSize / 2 > DANGER_ZONE_Y) {
                        // Play Fail Sound: Low-pitched short beep
                        playSound(150, 0.15, 'sine', 0.8); 

                        // Deduct score
                        score -= 15;
                        if (score < 0) score = 0;
                        scoreDisplay.textContent = score;

                        // Remove fallen icon.
                        fallingIcons.splice(i, 1);
                        continue;
                    }
                }
            }
        }

        function draw() {
            if (!isGameRunning) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw Danger Zone
            ctx.strokeStyle = '#ff4757';
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(0, DANGER_ZONE_Y);
            ctx.lineTo(canvas.width, DANGER_ZONE_Y);
            ctx.stroke();

            // Flashing effect for Danger Zone
            if (Math.floor(runningTime / 150) % 2 === 0) {
                ctx.fillStyle = 'rgba(255, 255, 0, 0.4)';
                ctx.fillRect(0, DANGER_ZONE_Y - 5, canvas.width, 10);
            }

            fallingIcons.forEach(icon => {
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';

                ctx.globalAlpha = icon.isDestroying ? 2 - icon.destroyScale : 1;
                ctx.font = `${icon.iconSize}px Arial`;
                ctx.fillText(icon.icon, icon.x, icon.y);
                ctx.globalAlpha = 1;

                if (!icon.isDestroying) {
                    ctx.font = 'bold 16px Arial';
                    ctx.fillStyle = '#1a237e';
                    ctx.strokeStyle = '#ffffff';
                    ctx.lineWidth = 3;
                    ctx.strokeText(icon.remainingLetters, icon.x, icon.y + icon.iconSize / 2 + 15);
                    ctx.fillText(icon.remainingLetters, icon.x, icon.y + icon.iconSize / 2 + 15);
                }
            });

            // Draw collected word count
            ctx.font = 'bold 20px Arial';
            ctx.fillStyle = '#1a237e';
            ctx.textAlign = 'left';
            ctx.fillText(`Collected: ${wordsCollected} / ${TOTAL_WORDS_TO_COLLECT}`, 10, 30);
        }

        // --- Input and Utility Functions ---
        function createVirtualKeyboard() {
            const rows = [
                "QWERTYUIOP",
                "ASDFGHJKL",
                "ZXCVBNM"
            ];

            virtualKeyboard.innerHTML = '';

            rows.forEach(rowKeys => {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'keyboard-row';

                for (let i = 0; i < rowKeys.length; i++) {
                    const key = rowKeys[i];
                    const button = document.createElement('button');
                    button.className = 'key-button';
                    button.textContent = key;
                    button.onclick = () => handleInput(key);
                    rowDiv.appendChild(button);
                }
                virtualKeyboard.appendChild(rowDiv);
            });
        }

        document.addEventListener('keydown', (e) => {
            if (isGameRunning) {
                // Ensure audio context is resumed on first user interaction if needed
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
                handleInput(e.key.toUpperCase());
            }
        });

        function handleInput(typedKey) {
            if (!isGameRunning || typedKey.length !== 1 || typedKey < 'A' || typedKey > 'Z') {
                return;
            }

            let foundMatch = false;

            for (let i = 0; i < fallingIcons.length; i++) {
                const icon = fallingIcons[i];
                if (icon.isDestroying) continue;

                const matchIndex = icon.remainingLetters.indexOf(typedKey);

                if (matchIndex !== -1) {
                    foundMatch = true;
                    // Play Success Sound: High-pitched short tone
                    playSound(600, 0.08, 'square', 0.6); 

                    icon.remainingLetters = icon.remainingLetters.slice(0, matchIndex) +
                        icon.remainingLetters.slice(matchIndex + 1);

                    if (icon.remainingLetters.length === 0) {
                        // Play Destroy Sound: Medium-low pitched tone
                        playSound(300, 0.2, 'sine', 0.7); 

                        score += 10 + Math.floor((DANGER_ZONE_Y - icon.y) / 10);
                        scoreDisplay.textContent = score;
                        icon.isDestroying = true;

                        // Speak the completed word (e.g., "SUN" is read as "sun")
                        speakWord(icon.targetWord);

                        wordsCollected++;
                        if (wordsCollected >= TOTAL_WORDS_TO_COLLECT) {
                            setTimeout(showLevelCompleteScreen, 500);
                        }
                    }

                    currentInputDisplay.textContent = typedKey;

                    break;
                }
            }

            if (!foundMatch) {
                // Play Fail Sound: Low-pitched short beep
                playSound(150, 0.15, 'sine', 0.8); 
                
                currentInputDisplay.textContent = typedKey;
                currentInputDisplay.classList.add('typed-error');
                setTimeout(() => {
                    currentInputDisplay.classList.remove('typed-error');
                    if (isGameRunning) currentInputDisplay.textContent = '‡∏£‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå...';
                }, 400);
            }
        }

        function formatTime(ms) {
            const totalSeconds = Math.floor(ms / 1000);
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }

        pauseBtn.onclick = returnToMenu;

        function gameLoop() {
            if (isGameRunning) {
                update();
                draw();
            }
            gameLoopId = requestAnimationFrame(gameLoop);
        }

        // --- Initialization ---
        createVirtualKeyboard();
        generateLevels();
        resizeCanvas();
        gameLoop();
    </script>
</body>

</html>
